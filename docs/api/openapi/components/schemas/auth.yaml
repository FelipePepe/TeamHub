LoginRequest:
  type: object
  required: [email, password]
  properties:
    email:
      type: string
      format: email
    password:
      type: string
      format: password

LoginResponse:
  type: object
  description: If mfaRequired/mfaSetupRequired/passwordChangeRequired are true, accessToken/refreshToken/user may be omitted. Use mfaToken to change password (auth/change-password), enroll (mfa/setup) and verify (mfa/verify).
  properties:
    accessToken:
      type: string
    refreshToken:
      type: string
    user:
      $ref: '../index.yaml#/schemas/UserResponse'
    mfaRequired:
      type: boolean
    mfaSetupRequired:
      type: boolean
    passwordChangeRequired:
      type: boolean
    mfaToken:
      type: string

MfaSetupResponse:
  type: object
  required: [secret, otpauthUrl]
  properties:
    secret:
      type: string
    otpauthUrl:
      type: string

MfaVerifyRequest:
  type: object
  required: [mfaToken, code]
  properties:
    mfaToken:
      type: string
    code:
      type: string
      description: 6-digit TOTP code

MfaVerifyResponse:
  type: object
  required: [accessToken, refreshToken, user]
  properties:
    accessToken:
      type: string
    refreshToken:
      type: string
    user:
      $ref: '../index.yaml#/schemas/UserResponse'
    recoveryCodes:
      type: array
      items:
        type: string

RefreshRequest:
  type: object
  required: [refreshToken]
  properties:
    refreshToken:
      type: string

TokenPairResponse:
  type: object
  required: [accessToken, refreshToken]
  properties:
    accessToken:
      type: string
    refreshToken:
      type: string

LogoutRequest:
  type: object
  properties:
    refreshToken:
      type: string

ForgotPasswordRequest:
  type: object
  required: [email]
  properties:
    email:
      type: string
      format: email

ResetPasswordRequest:
  type: object
  required: [token, newPassword]
  properties:
    token:
      type: string
    newPassword:
      type: string
      format: password

AuthChangePasswordRequest:
  type: object
  required: [mfaToken, newPassword]
  properties:
    mfaToken:
      type: string
    newPassword:
      type: string
      format: password

AuthChangePasswordResponse:
  type: object
  required: [mfaToken]
  properties:
    mfaToken:
      type: string
    mfaRequired:
      type: boolean
    mfaSetupRequired:
      type: boolean

MfaBackupRequest:
  type: object
  required: [mfaToken, backupCode]
  properties:
    mfaToken:
      type: string
    backupCode:
      type: string
      description: One of the 10 backup codes

MfaStatusResponse:
  type: object
  required: [enabled]
  properties:
    enabled:
      type: boolean
    activatedAt:
      type: string
      format: date-time

BackupCodesResponse:
  type: object
  required: [codes]
  properties:
    codes:
      type: array
      items:
        type: string
      description: 10 reusable backup codes

RegenerateMfaRequest:
  type: object
  required: [password, code]
  properties:
    password:
      type: string
      format: password
      description: Current password
    code:
      type: string
      description: Current TOTP code

ResetMfaResponse:
  type: object
  required: [secret, otpauthUrl, qrCode]
  properties:
    secret:
      type: string
    otpauthUrl:
      type: string
    qrCode:
      type: string
      description: Base64 encoded QR code image

UpdatePerfilRequest:
  type: object
  properties:
    nombre:
      type: string
    apellidos:
      type: string
    email:
      type: string
      format: email

AvatarResponse:
  type: object
  required: [avatarUrl]
  properties:
    avatarUrl:
      type: string
      format: uri
